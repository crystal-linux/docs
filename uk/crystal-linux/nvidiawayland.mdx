---
title: Як запустити Wayland на відеокарті NVIDIA
---
Wayland вимагає, щоб для графічного процесора nvidia було ввімкнено налаштування режиму, для цього вам потрібно додати драйвери nvidia до модулів mkinitcpio та додати позначку ядра `nvidia-drm.modeset=1`

## Додавання nvidia до модулів mkinitcpio
Щоб додати необхідні модулі nvidia `nvidia nvidia_modeset nvidia_uvm nvidia_drm` до модулів mkinitcpio, потрібно відредагувати `/etc/mkinitcpio.conf`, запустивши `sudo nano /etc/mkinitcpio.conf`
у цьому файлі має бути рядок, який виглядає так:
```
MODULES=()
```
додайте модулі у дужки, назви модулів розділяються пробілами, в кінці рядок має виглядати так:
```
MODULES=(nvidia nvidia_modeset nvidia_uvm nvidia_drm)
```
Щоб зберегти файл, вам потрібно натиснути `CTRL+O` і вийти за допомогою `CTRL+X`
Тепер створіть initramfs:
```
sudo mkinitcpio -P
```

## Додавання прапора ядра
Щоб додати прапор ядра за допомогою grub, потрібно відредагувати `/etc/default/grub`, запустивши `sudo nano /etc/default/grub`, знайдіть рядок, який виглядає так:
```
GRUB_CMDLINE_LINUX_DEFAULT="loglevel=3 quiet"
```
Вам потрібно буде додати `nvidia-drm.modeset=1` до цього рядка, щоб він виглядав так:

```
GRUB_CMDLINE_LINUX_DEFAULT="loglevel=3 quiet nvidia_drm.modeset=1"
```
Так само, як і з модулями mkinitcpio, щоб зберегти та вийти, вам доведеться спочатку натиснути `CTRL+O`, а потім `CTRL+X`
Після того, як ви додасте параметр ядра, повторно створіть конфігурацію grub, щоб відобразити зміни прапора ядра, для цього вам потрібно запустити
```
sudo grub-mkconfig -o /boot/grub/grub.cfg
```
Це створить конфігурацію grub і збереже її у /boot/grub/grub.cfg

## Додаткові кроки для GNOME та onyx
GDM використовує деякі залежні від чипсета [правила udev](https://wiki.archlinux.org/title/Udev), щоб перевірити, чи він примусово використовує Xorg замість Wayland. Ці правила udev можна вимкнути, виконавши цю команду:
### Видалення gdm udev, який вимикає Wayland

GDM використовує деякі залежні від чипсета [правила udev](https://gitlab.gnome.org/GNOME/gdm/-/blob/main/data/61-gdm.rules.in), щоб перевірити, чи слід примусово використовувати Xorg замість Wayland. Якщо ви хочете примусово ввімкнути Wayland, виконайте цю команду.

```
sudo ln -s /dev/null /etc/udev/rules.d/61-gdm.rules
```

Ця команда повинна символічно посилатися на правила udev GDM з _нічого_. Правила у `/etc/udev/rules.d/` повинні перезаписати правила у `/usr/lib/udev/rules.d` (які надсилаються самим пакетом і керуються вашим менеджером пакетів).
А після цього перезавантажтеся, і GNOME Wayland _має_ працювати!

## Перезавантаження
Після того, як ви пройшли всі кроки, а саме:
- додали модулі mkinitcpio
- створили initcpio
- додали прапорці ядра за допомогою grub
- згенерували конфігурацію grub
- необов'язково вимкнули правила udev

Тепер ви можете використовувати Wayland! Просто перезавантажте систему, і ви зможете увійти в сеанс Wayland


Якщо все одно не працює, можливо, ваш графічний процесор не підтримує Wayland у власних драйверах NVIDIA. Це не можна виправити, окрім використання драйвера nouveau, який, на жаль, працює не так добре, як власні драйвери nvidia.